print(PM25)
print(em_count[i])
corr_df <- rbind(corr_df, data.frame(id = i, PM10=PM10, PM25=PM25, emitery=em_count[i]))
}
library(dplyr)
emitory_sf  <- st_as_sf(emitory_UTM)
czujniki_sf <- st_as_sf(data_in)
buf_distance=1500
inrange <- st_is_within_distance(
czujniki_sf,
emitory_sf,
dist = buf_distance
)
em_count = lengths(inrange)
#a<-data.frame(inrange)
#a
#plot(data15_ppp)
#plot(data15_ppp[id])
#plot(emitory_by_czujnik[[id]], add=TRUE, col='blue')
corr_df <- data.frame(
matrix(ncol = 4, nrow = 0)  # 3 columns, 0 rows
)
colnames(corr_df) <- c("id","PM10","PM25","emitery")
for (i in 1:64) {
PM10 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM10"]
PM25 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM25"]
if (is.null(PM10) || length(PM10) == 0) PM10=-1
if (is.null(PM25) || length(PM25) == 0) PM25=-1
corr_df <- rbind(corr_df, data.frame(id = i, PM10=PM10, PM25=PM25, emitery=em_count[i]))
}
corr_PM10 <- corr_df[,c("id","PM10","emitery")]
corr_PM10_filtred <- subset(corr_PM10, PM10 != -1)
plot(x=corr_PM10_filtred$emitery,y=corr_PM10_filtred$PM10)
cor(x=corr_PM10_filtred$emitery,y=corr_PM10_filtred$PM10)
corr_PM25 <- corr_df[,c("id","PM25","emitery")]
corr_PM25_filtred <- subset(corr_PM25, PM25 != -1)
cor(x=corr_PM25_filtred$emitery,y=corr_PM25_filtred$PM25)
plot(x=corr_PM25_filtred$emitery,y=corr_PM25_filtred$PM25)
library(dplyr)
emitory_sf  <- st_as_sf(emitory_UTM)
czujniki_sf <- st_as_sf(data_in)
buf_distance=5000
inrange <- st_is_within_distance(
czujniki_sf,
emitory_sf,
dist = buf_distance
)
em_count = lengths(inrange)
#a<-data.frame(inrange)
#a
#plot(data15_ppp)
#plot(data15_ppp[id])
#plot(emitory_by_czujnik[[id]], add=TRUE, col='blue')
corr_df <- data.frame(
matrix(ncol = 4, nrow = 0)  # 3 columns, 0 rows
)
colnames(corr_df) <- c("id","PM10","PM25","emitery")
for (i in 1:64) {
PM10 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM10"]
PM25 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM25"]
if (is.null(PM10) || length(PM10) == 0) PM10=-1
if (is.null(PM25) || length(PM25) == 0) PM25=-1
corr_df <- rbind(corr_df, data.frame(id = i, PM10=PM10, PM25=PM25, emitery=em_count[i]))
}
corr_PM10 <- corr_df[,c("id","PM10","emitery")]
corr_PM10_filtred <- subset(corr_PM10, PM10 != -1)
cor(x=corr_PM10_filtred$emitery,y=corr_PM10_filtred$PM10)
plot(x=corr_PM10_filtred$emitery,y=corr_PM10_filtred$PM10)
corr_PM25 <- corr_df[,c("id","PM25","emitery")]
corr_PM25_filtred <- subset(corr_PM25, PM25 != -1)
cor(x=corr_PM25_filtred$emitery,y=corr_PM25_filtred$PM25)
plot(x=corr_PM25_filtred$emitery,y=corr_PM25_filtred$PM25)
cor.test(filt_PM25$emitery, filt_PM25$PM25, method = "pearson")
corr_PM25 <- corr_df[,c("id","PM25","emitery")]
filt_PM25 <- subset(corr_PM25, PM25 != -1)
cor(x=filt_PM25$emitery,y=filt_PM25$PM25)
cor.test(filt_PM25$emitery, filt_PM25$PM25, method = "pearson")
plot(x=filt_PM25$emitery,y=filt_PM25$PM25)
corr_PM10 <- corr_df[,c("id","PM10","emitery")]
filt_PM10 <- subset(corr_PM10, PM10 != -1)
cor(x=filt_PM10$emitery,y=filt_PM10$PM10)
cor.test(filt_PM10$emitery, filt_PM10$PM10, method = "pearson")
plot(x=filt_PM10$emitery,y=filt_PM10$PM10)
plot(data15_ppp)
plot(data15_ppp[id])
plot(emitory_by_czujnik[[id]], add=TRUE, col='blue')
plot(data15_ppp)
plot(data15_ppp[5])
plot(emitory_by_czujnik[[5]], add=TRUE, col='blue')
plot(data15_ppp[5])
plot(emitory_by_czujnik[[5]], add=TRUE, col='blue')
#a<-data.frame(inrange)
#a
plot(data15_ppp)
plot(data15_ppp[5])
plot(emitory_by_czujnik[[5]])
, add=TRUE, col='blue'
plot(emitory_by_czujnik[[5]], add=TRUE, col='blue')
plot(data15_ppp[3])
plot(emitory_by_czujnik[[3]], add=TRUE,
plot(data15_ppp[3])
plot(emitory_by_czujnik[[3]], add=TRUE, col='blue')
plot(emitory_by_czujnik[[3]], pch=20,add=TRUE, col='blue')
plot(data15_ppp[3])
plot(emitory_by_czujnik[[3]], pch=20,add=TRUE, col='blue')
library(dplyr)
emitory_sf  <- st_as_sf(emitory_UTM)
czujniki_sf <- st_as_sf(data_in)
buf_distance=5000
inrange <- st_is_within_distance(
czujniki_sf,
emitory_sf,
dist = buf_distance
)
em_count = lengths(inrange)
#a<-data.frame(inrange)
#a
plot(data15_ppp)
plot(data15_ppp[3])
plot(emitory_by_czujnik[[3]], pch=20,add=TRUE, col='blue')
corr_df <- data.frame(
matrix(ncol = 4, nrow = 0)  # 3 columns, 0 rows
)
colnames(corr_df) <- c("id","PM10","PM25","emitery")
for (i in 1:64) {
PM10 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM10"]
PM25 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM25"]
if (is.null(PM10) || length(PM10) == 0) PM10=-1
if (is.null(PM25) || length(PM25) == 0) PM25=-1
corr_df <- rbind(corr_df, data.frame(id = i, PM10=PM10, PM25=PM25, emitery=em_count[i]))
}
library(dplyr)
emitory_sf  <- st_as_sf(emitory_UTM)
czujniki_sf <- st_as_sf(data_in)
buf_distance=3000
inrange <- st_is_within_distance(
czujniki_sf,
emitory_sf,
dist = buf_distance
)
em_count = lengths(inrange)
#a<-data.frame(inrange)
#a
plot(data15_ppp)
plot(data15_ppp[3])
plot(emitory_by_czujnik[[3]], pch=20,add=TRUE, col='blue')
corr_df <- data.frame(
matrix(ncol = 4, nrow = 0)  # 3 columns, 0 rows
)
colnames(corr_df) <- c("id","PM10","PM25","emitery")
for (i in 1:64) {
PM10 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM10"]
PM25 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM25"]
if (is.null(PM10) || length(PM10) == 0) PM10=-1
if (is.null(PM25) || length(PM25) == 0) PM25=-1
corr_df <- rbind(corr_df, data.frame(id = i, PM10=PM10, PM25=PM25, emitery=em_count[i]))
}
library(dplyr)
emitory_sf  <- st_as_sf(emitory_UTM)
czujniki_sf <- st_as_sf(data_in)
buf_distance=3000
inrange <- st_is_within_distance(
czujniki_sf,
emitory_sf,
dist = buf_distance
)
em_count = lengths(inrange)
#a<-data.frame(inrange)
#a
id = 3
emitory_by_czujnik <- lapply(seq(inrange), function(i){
length(i)
})
plot(data15_ppp)
plot(data15_ppp[id])
plot(emitory_by_czujnik[[id]], pch=20,add=TRUE, col='blue')
corr_df <- data.frame(
matrix(ncol = 4, nrow = 0)  # 3 columns, 0 rows
)
colnames(corr_df) <- c("id","PM10","PM25","emitery")
for (i in 1:64) {
PM10 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM10"]
PM25 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM25"]
if (is.null(PM10) || length(PM10) == 0) PM10=-1
if (is.null(PM25) || length(PM25) == 0) PM25=-1
corr_df <- rbind(corr_df, data.frame(id = i, PM10=PM10, PM25=PM25, emitery=em_count[i]))
}
library(dplyr)
emitory_sf  <- st_as_sf(emitory_UTM)
czujniki_sf <- st_as_sf(data_in)
buf_distance=3000
inrange <- st_is_within_distance(
czujniki_sf,
emitory_sf,
dist = buf_distance
)
em_count = lengths(inrange)
#a<-data.frame(inrange)
#a
id = 3
emitory_by_czujnik <- lapply(seq_along(inrange), function(i) {
emitory_sf[inrange[[i]], ]
})
plot(data15_ppp)
plot(data15_ppp[id])
plot(emitory_by_czujnik[[id]], pch=20,add=TRUE, col='blue')
corr_df <- data.frame(
matrix(ncol = 4, nrow = 0)  # 3 columns, 0 rows
)
colnames(corr_df) <- c("id","PM10","PM25","emitery")
for (i in 1:64) {
PM10 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM10"]
PM25 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM25"]
if (is.null(PM10) || length(PM10) == 0) PM10=-1
if (is.null(PM25) || length(PM25) == 0) PM25=-1
corr_df <- rbind(corr_df, data.frame(id = i, PM10=PM10, PM25=PM25, emitery=em_count[i]))
}
library(dplyr)
emitory_sf  <- st_as_sf(emitory_UTM)
czujniki_sf <- st_as_sf(data_in)
buf_distance=2000
inrange <- st_is_within_distance(
czujniki_sf,
emitory_sf,
dist = buf_distance
)
em_count = lengths(inrange)
#a<-data.frame(inrange)
#a
id = 3
emitory_by_czujnik <- lapply(seq_along(inrange), function(i) {
emitory_sf[inrange[[i]], ]
})
plot(data15_ppp)
plot(data15_ppp[id])
plot(emitory_by_czujnik[[id]], pch=20,add=TRUE, col='blue')
corr_df <- data.frame(
matrix(ncol = 4, nrow = 0)  # 3 columns, 0 rows
)
colnames(corr_df) <- c("id","PM10","PM25","emitery")
for (i in 1:64) {
PM10 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM10"]
PM25 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM25"]
if (is.null(PM10) || length(PM10) == 0) PM10=-1
if (is.null(PM25) || length(PM25) == 0) PM25=-1
corr_df <- rbind(corr_df, data.frame(id = i, PM10=PM10, PM25=PM25, emitery=em_count[i]))
}
library(dplyr)
emitory_sf  <- st_as_sf(emitory_UTM)
czujniki_sf <- st_as_sf(data_in)
buf_distance=2500
inrange <- st_is_within_distance(
czujniki_sf,
emitory_sf,
dist = buf_distance
)
em_count = lengths(inrange)
#a<-data.frame(inrange)
#a
id = 3
emitory_by_czujnik <- lapply(seq_along(inrange), function(i) {
emitory_sf[inrange[[i]], ]
})
plot(data15_ppp)
plot(data15_ppp[id])
plot(emitory_by_czujnik[[id]], pch=20,add=TRUE, col='blue')
corr_df <- data.frame(
matrix(ncol = 4, nrow = 0)  # 3 columns, 0 rows
)
colnames(corr_df) <- c("id","PM10","PM25","emitery")
for (i in 1:64) {
PM10 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM10"]
PM25 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM25"]
if (is.null(PM10) || length(PM10) == 0) PM10=-1
if (is.null(PM25) || length(PM25) == 0) PM25=-1
corr_df <- rbind(corr_df, data.frame(id = i, PM10=PM10, PM25=PM25, emitery=em_count[i]))
}
library(dplyr)
emitory_sf  <- st_as_sf(emitory_UTM)
czujniki_sf <- st_as_sf(data_in)
buf_distance=2500
inrange <- st_is_within_distance(
czujniki_sf,
emitory_sf,
dist = buf_distance
)
em_count = lengths(inrange)
#a<-data.frame(inrange)
#a
id = 3
emitory_by_czujnik <- lapply(seq_along(inrange), function(i) {
emitory_sf[inrange[[i]], ]
})
plot(data15_ppp)
plot(data15_ppp[id])
plot(emitory_by_czujnik[[id]], pch=20,add=TRUE, col='blue')
corr_df <- data.frame(
matrix(ncol = 4, nrow = 0)  # 3 columns, 0 rows
)
colnames(corr_df) <- c("id","PM10","PM25","emitery")
for (i in 1:64) {
PM10 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM10"]
PM25 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM25"]
if (is.null(PM10) || length(PM10) == 0) PM10=-1
if (is.null(PM25) || length(PM25) == 0) PM25=-1
corr_df <- rbind(corr_df, data.frame(id = i, PM10=PM10, PM25=PM25, emitery=em_count[i]))
}
corr_PM10 <- corr_df[,c("id","PM10","emitery")]
filt_PM10 <- subset(corr_PM10, PM10 != -1)
cor(x=filt_PM10$emitery,y=filt_PM10$PM10)
cor.test(filt_PM10$emitery, filt_PM10$PM10, method = "pearson")
plot(x=filt_PM10$emitery,y=filt_PM10$PM10)
corr_PM25 <- corr_df[,c("id","PM25","emitery")]
filt_PM25 <- subset(corr_PM25, PM25 != -1)
cor(x=filt_PM25$emitery,y=filt_PM25$PM25)
cor.test(filt_PM25$emitery, filt_PM25$PM25, method = "pearson")
plot(x=filt_PM25$emitery,y=filt_PM25$PM25)
library(dplyr)
emitory_sf  <- st_as_sf(emitory_UTM)
czujniki_sf <- st_as_sf(data_in)
buf_distance=2500
inrange <- st_is_within_distance(
czujniki_sf,
emitory_sf,
dist = buf_distance
)
em_count = lengths(inrange)
id = 1:10
emitory_by_czujnik <- lapply(seq_along(inrange), function(i) {
emitory_sf[inrange[[i]], ]
})
plot(data15_ppp)
plot(data15_ppp[id])
plot(emitory_by_czujnik[[id]], pch=20,add=TRUE, col='blue')
library(dplyr)
emitory_sf  <- st_as_sf(emitory_UTM)
czujniki_sf <- st_as_sf(data_in)
buf_distance=2500
inrange <- st_is_within_distance(
czujniki_sf,
emitory_sf,
dist = buf_distance
)
em_count = lengths(inrange)
for (id in 1:10){
emitory_by_czujnik <- lapply(seq_along(inrange), function(i) {
emitory_sf[inrange[[i]], ]
})
plot(data15_ppp)
plot(data15_ppp[id])
plot(emitory_by_czujnik[[id]], pch=20,add=TRUE, col='blue')
}
corr_df <- data.frame(
matrix(ncol = 4, nrow = 0)  # 3 columns, 0 rows
)
colnames(corr_df) <- c("id","PM10","PM25","emitery")
for (i in 1:64) {
PM10 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM10"]
PM25 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM25"]
if (is.null(PM10) || length(PM10) == 0) PM10=-1
if (is.null(PM25) || length(PM25) == 0) PM25=-1
corr_df <- rbind(corr_df, data.frame(id = i, PM10=PM10, PM25=PM25, emitery=em_count[i]))
}
library(dplyr)
emitory_sf  <- st_as_sf(emitory_UTM)
czujniki_sf <- st_as_sf(data_in)
buf_distance=2500
inrange <- st_is_within_distance(
czujniki_sf,
emitory_sf,
dist = buf_distance
)
em_count = lengths(inrange)
for (id in 1:64){
emitory_by_czujnik <- lapply(seq_along(inrange), function(i) {
emitory_sf[inrange[[i]], ]
})
plot(data15_ppp)
plot(data15_ppp[id])
plot(emitory_by_czujnik[[id]], pch=20,add=TRUE, col='blue')
}
corr_df <- data.frame(
matrix(ncol = 4, nrow = 0)  # 3 columns, 0 rows
)
colnames(corr_df) <- c("id","PM10","PM25","emitery")
for (i in 1:64) {
PM10 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM10"]
PM25 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM25"]
if (is.null(PM10) || length(PM10) == 0) PM10=-1
if (is.null(PM25) || length(PM25) == 0) PM25=-1
corr_df <- rbind(corr_df, data.frame(id = i, PM10=PM10, PM25=PM25, emitery=em_count[i]))
}
library(dplyr)
emitory_sf  <- st_as_sf(emitory_UTM)
czujniki_sf <- st_as_sf(data_in)
buf_distance=2500
inrange <- st_is_within_distance(
czujniki_sf,
emitory_sf,
dist = buf_distance
)
em_count = lengths(inrange)
emitory_by_czujnik <- lapply(seq_along(inrange), function(i) {
emitory_sf[inrange[[i]], ]
})
corr_df <- data.frame(
matrix(ncol = 4, nrow = 0)  # 3 columns, 0 rows
)
colnames(corr_df) <- c("id","PM10","PM25","emitery")
for (i in 1:64) {
PM10 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM10"]
PM25 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM25"]
if (is.null(PM10) || length(PM10) == 0) PM10=-1
if (is.null(PM25) || length(PM25) == 0) PM25=-1
corr_df <- rbind(corr_df, data.frame(id = i, PM10=PM10, PM25=PM25, emitery=em_count[i]))
}
for (id in 1:64){
plot(data15_ppp)
plot(data15_ppp[id])
plot(emitory_by_czujnik[[id]], pch=20,add=TRUE, col='blue')
}
#jeżeli się nie zaznacza nic na plocie to znaczy że czujnik nie działa
emitory = ANTROPOPRESJA_emitory_pyłów_i_gazów
emitory_df <- data.frame(
x = emitory$`X [PL-1992]`,
y = emitory$`Y [PL-1992]`,
id = emitory$OBJECTID
)
coordinates(emitory_df) <- ~x+y
proj4string(emitory_df) <- CRS("+init=epsg:2180")
emitory_UTM <- spTransform(
emitory_df,
CRS("+proj=utm +zone=34 +datum=WGS84 +units=m +no_defs")
)
XY2 <- coordinates(emitory_UTM)
head(XY2)
emitory_ppp <- ppp(
x = XY2[,1],
y = XY2[,2],
window=as.owin(krakowUTM)
)
plot(data15_ppp)
plot(emitory_ppp, add=TRUE, pch=20, col='red')
library(dplyr)
emitory_sf  <- st_as_sf(emitory_UTM)
czujniki_sf <- st_as_sf(data_in)
buf_distance=2500
inrange <- st_is_within_distance(
czujniki_sf,
emitory_sf,
dist = buf_distance
)
em_count = lengths(inrange)
emitory_by_czujnik <- lapply(seq_along(inrange), function(i) {
emitory_sf[inrange[[i]], ]
})
corr_df <- data.frame(
matrix(ncol = 4, nrow = 0)  # 3 columns, 0 rows
)
colnames(corr_df) <- c("id","PM10","PM25","emitery")
for (i in 1:64) {
PM10 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM10"]
PM25 <- list_inst2[[i]]$current$values$value[list_inst2[[i]]$current$values$name == "PM25"]
if (is.null(PM10) || length(PM10) == 0) PM10=-1
if (is.null(PM25) || length(PM25) == 0) PM25=-1
corr_df <- rbind(corr_df, data.frame(id = i, PM10=PM10, PM25=PM25, emitery=em_count[i]))
}
#ploty do wglądu
# for (id in 1:64){
#   plot(data15_ppp)
#   plot(data15_ppp[id])
#   plot(emitory_by_czujnik[[id]], pch=20,add=TRUE, col='blue')
# }
#jeżeli się nie zaznacza nic na plocie to znaczy że czujnik nie działa
corr_PM10 <- corr_df[,c("id","PM10","emitery")]
filt_PM10 <- subset(corr_PM10, PM10 != -1)
cor(x=filt_PM10$emitery,y=filt_PM10$PM10)
cor.test(filt_PM10$emitery, filt_PM10$PM10, method = "pearson")
plot(x=filt_PM10$emitery,y=filt_PM10$PM10)
corr_PM25 <- corr_df[,c("id","PM25","emitery")]
filt_PM25 <- subset(corr_PM25, PM25 != -1)
cor(x=filt_PM25$emitery,y=filt_PM25$PM25)
cor.test(filt_PM25$emitery, filt_PM25$PM25, method = "pearson")
plot(x=filt_PM25$emitery,y=filt_PM25$PM25)
setwd("~/studia/s5/klimat/projekt2/airly")
#tworzymy listę plików z danymi, aby móc je później wspólnie przetwarzać
files <- list.files(pattern = "^dane_.*\\.RData$")
files
#ładujemy teraz wszystkie pliki z listy files do środowiska i wpakowujemy do listy lista_danych
lista_danych <- lapply(files, function(f) {
e <- new.env() #jakby wszystko pakować do Global Environment to by się dane nadpisywały
load(f, envir = e)
e$list_inst2
})
#teraz tak działa odwoływanie się
lista_danych[[1]][[30]]$current$values
#funckja tworząca wektor z wartościami PM2.5
get_pm25 <- function(plik) {
n_id <- length(plik)
pm25 <- rep(NA,n_id)   # przygotowujemy wektor wyników
for (i in seq(1,n_id)) {
inst <- plik[[i]]
logic <- inst$current$values$name == "PM25"
if (sum(logic) == 1) {
pm25[i] <- inst$current$values[logic,2]
}
}
return(pm25)
}
lista_pm25 <- lapply(lista_danych, get_pm25)
#sprawdzenie
lista_pm25[[1]][30]
